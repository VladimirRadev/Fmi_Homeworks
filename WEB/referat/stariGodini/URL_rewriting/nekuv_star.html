<!DOCTYPE html>
<html lang="bg">

    <head>
    	<title>URL rewriting</title>
    	<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" type="text/css" href="./css/referatStyleS.css">
		<script src="./javascript/scripts.js"></script>
	</head>

    <body>

        <header id="header">
        	<h1><a>URL rewriting</a></h1>
            <h3><a href="#usedresources">Използвани източници</a></h3>
            <h3><a onclick="openNav()">Съдържание на реферата</a></h3>
		</header>
		
		<div id="mySidenav" class="sidenav">
			<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
			<ol>
				<li><a class="sidenav-item" href="#whatisurl">Какво е URL?</a></li>
				<li><a class="sidenav-item" href="#preview">Преглед на URL адрес</a></li>
				<li><a class="sidenav-item" href="#forbiddensymbols">Забранени символи в URL</a></li>
				<li><a class="sidenav-item" href="#urlrewriting">URL пренаписване</a></li>
				<li><a class="sidenav-item" href="#whatisurlrewriting">Какво е URL пренаписване?</a></li>
				<li><a class="sidenav-item" href="#platformsandtools">Платформи и инструменти</a></li>
				<li><a class="sidenav-item" href="#basicrewriting">Основно презаписване на URL</a></li>
				<li><a class="sidenav-item" href="#modelsandreplace">Модели и замествания</a></li>
				<li><a class="sidenav-item" href="#regexp">Регулярни изрази</a></li>
				<li><a class="sidenav-item" href="#flags">Знамена</a></li>
			</ol>
        </div>

        <main id="main">
			<div>
				<h2 id="whatisurl"><u>Какво е <i>URL</i> адрес</u><a href="#link1"><i>[1]</i></a></h2>
				<p>Известен също като уеб адрес, <i>URL (Uniform Resource Locator)</i> е форма на <i>URI</i> и стандартизирана конвенция за именуване за адресиране на документи, достъпни чрез Интернет и Интранет. Пример за URL адрес е <i>https://www.computerhope.com</i>, който е <i>URL</i> за уебсайта на <i>Computer Hope</i>. <p>
			</div>
			
			<div>
                <h2 id="preview"><u>Преглед на <i>URL</i> адрес</u></h2>
                    <p>По-долу има допълнителна информация за всяка от секциите на <i>http URL</i> за тази страница.</p>
					<pre><code>
https://www.computerhope.com/jargon/u/url.htm
					</code></pre>
						<ol>
							<li><b>https://</b> - протокол
							</li>
							<li><b>www.</b> - поддомейн
							</li>
							<li><b>computerhope.</b> - домейн
							</li>
							<li><b>com/</b> - наставка (суфикс) на домейн
							</li>
							<li><b>jargon/u/</b> - директории
							</li>
							<li><b>url.htm</b> - уеб страница
							</li>
						</ol>
						
						<ul>
							<li><h3>http:// или https://</h3>
								<p><i>"Http"</i> съкратено от <i>Hypertext Transfer Protocol</i> означава „Протокол за пренос на хипертекст“. Той позволява на браузъра да знае кой протокол ще използва за достъп до информацията, посочена в домейна. Протоколът <i>„https“</i> съкратено от <i>Hypertext Transfer Protocol Secure</i> и означава „Безопасен протокол за пренос на хипертекст“ и показва, че информацията, предавана през <i>HTTP</i>, е криптирана и защитена. След <i>http</i> или <i>https</i> е двоеточието (:) и две предни наклонени черти (//), които отделят протокола от останалата част от <i>URL</i> адреса. </p>
							</li>
							<li><h3>www.</h3>
								<p>Съкращението на <i>"www"</i> е <i>World Wide Web</i>, означава световна мрежа и се използва за разграничаване на съдържанието. Тази част от <i>URL</i> адреса не е задължителна и много пъти може да бъде пропусната. Например, въвеждането на <i>„http://computerhope.com“</i> пак ще ви отведе до уебсайта на <i>Computer Hope</i>. Тази част от адреса също може да бъде заменена за важна подстраница, известна като поддомейн.</p>
							</li>
							<li><h3>computerhope.com</h3>
								<p>На следващо място, <i>"computerhope.com"</i> е името на домейна за уебсайта. Последната част от домейна е известна като суфикс на домейна или <i>TLD (Top level domain)</i>. Използва се за идентифициране на типа или местоположението на уебсайта. Например <i>".com"</i> е кратко за търговски, <i>".org"</i> е кратко за организация, а <i>".co.uk"</i> е Обединеното кралство. Налични са няколко суфикса на домейна. За да получите домейн, трябва да регистрирате името чрез регистратор на домейн.</p>
							<li><h3>/jargon/u/</h3>
								<p>На следващо място,  <i>"jargon"</i> и <i>"u"</i> са директории, където уеб страницата се намира на сървъра. В този пример уеб страницата е дълбока в две директории, така че за да намерите файла на сървъра, това ще бъде в директорията <i>/public_html/jargon/u</i> . При повечето сървъри директорията <i>public_html</i> е директория по подразбиране, съдържаща <i>HTML</i> файловете.</p>
							</li>
						</ul>
			</div>
			
			<div>
				<h2 id="forbiddensymbols"><u>Забранени символи в URL</u></h2>
					<p>Повечето хора осъзнават, че в <i>URL</i> адреса не се допуска интервал. Важно е също така да се осъзнае, както е документирано в <i>RFC 1738</i>, <i>URL</i> низът може да съдържа само буквено-цифрови знаци и символите! <b>$ -_ + * '()</b>. Всички останали знаци, които са необходими в <i>URL</i> адреса, трябва да бъдат кодирани.</p>
			</div>
			
			<div>
				<h2 id="urlrewriting"><u>URL пренаписване<a href="#link2"><i>[2]</i></a></u></h2>
					<p>Пренаписването на <i>URL</i> адреси може да бъде един от най-добрите и бързи начини за подобряване на използваемостта и удобството за търсене на вашия сайт. Той може също да бъде източник на почти непрестанна мизерия и страдание. Определено си струва да играете внимателно с нея - препоръчва се много тестване.</p>
			</div>
			
			<div>
				<h2 id="whatisurlrewriting"><u>Какво е URL пренаписване?</u></h2>
					<p>Повечето динамични сайтове включват променливи в своите <i>URL</i> адреси, които казват на сайта каква информация да се покаже на потребителя. Обикновено това дава <i>URL</i> адреси като следния, като казва на съответния скрипт на сайта да зареди номер 7 на продукта. </p>
					<pre><code>
(http://www.pets.com/show_a_product.php?product_id=7) 
					</code></pre>
					<p>Проблемите с този вид <i>URL</i> структура са, че <i>URL</i> адресът изобщо не е запомнящ се. Трудно е да се чете по телефона (ще се изненадате колко хора предават <i>URL</i> адреси по този начин). Търсачките и потребителите не получават никаква полезна информация за съдържанието на страница от този <i>URL</i> адрес. Не можете да кажете от този <i>URL</i> адрес, че тази страница ви позволява да купите норвежки син папагал (прекрасно оперение). Това е доста стандартен <i>URL</i> адрес - видът, който бихте получили по подразбиране от повечето <i>CMS</i> (<i>Content management system</i>). Сравнете това с този <i>URL</i> адрес: </p>
					<pre><code>
http://www.pets.com/products/7/
					</code></pre>
					<p>Видимо е много по-чист и кратък <i>URL</i> адрес. Много по-лесно е да се запомни и изключително лесно да се чете, обаче не казва точно на никого, за какво се отнася. Но можем да направим повече: </p>
					<pre><code>
http://www.pets.com/parrots/norwegian-blue/ 
					</code></pre>
					<p>Сега изглежда по-информативно. Можете да кажете от <i>URL</i> адреса, дори когато е изваден от контекста, какво вероятно ще намерите на тази страница. Търсачките могат да разделят този <i>URL</i> адрес на думи (тиретата в <i>URL</i> адреси се третират като интервали от търсачките, докато подчертаването не се) и те могат да използват тази информация за по-добро определяне на съдържанието на страницата. Това е лесен <i>URL</i> адрес за запомняне и предаване на друг човек. </p>
					<p>За съжаление последният <i>URL</i> адрес не може да бъде лесно разбран от сървър без известна работа от наша страна. Когато е направена заявка за този <i>URL</i> адрес, сървърът трябва да измисли как да обработи този <i>URL</i> адрес, така че да знае какво да изпрати обратно на потребителя. Пренаписването на <i>URL</i> адреси е техниката, използвана за „превеждане“ на <i>URL</i> като последния пример в нещо, което сървърът може да разбере. </p>
			</div>
			
			<div>
				<h2 id="platformsandtools"><u>Платформи и инструменти</u></h2>
					<p>В зависимост от софтуера, с който вашият сървър работи, може вече да имате достъп до модули за презаписване на <i>URL</i> адреси. Ако това не е случаят, повечето хостове ще активират или инсталират съответните модули за вас.</p>
					<p><i>Apache</i> е най-лесната система, за да започнете презаписването на <i>URL</i> адреси. Обикновено се предлага със собствен вграден модул за презаписване на <i>URL</i> адреси, <i>mod_rewrite</i>, активиран и работата с <i>mod_rewrite</i> е толкова проста, колкото качването на правилно форматирани и кръстени текстови файлове.</p>
					<p><i>IIS</i>, сървърният софтуер на <i>Microsoft</i>, не включва възможност за презаписване на <i>URL</i> адреси като стандарт, но има добавки, които могат да осигурят тази функционалност. <i>ISAPI_Rewrite</i> е този, с който препоръчвам да се работи, тъй като е най-близо до функционалността на <i>mod_rewrite</i>.</p>
					<p>Кодът, който следва, се основава на пренаписване на <i>URL</i> с помощта на <i>mod_rewrite</i>.</p>
			</div>
			
			<div>
				<h2 id="basicrewriting"><u>Основно презаписване на URL</u></h2>
					<p>Като начало, нека разгледаме един прост пример. Имаме уебсайт и имаме един <i>PHP</i> скрипт, който обслужва една страница. Нейният <i>URL</i> адрес е:</p>
					<pre><code>
http://www.pets.com/pet_care_info_07_07_2008.php
					</code></pre>
					<p>Искаме да изчистим <i>URL</i> адреса и идеалният ни <i>URL</i> адрес би бил:</p>
					<pre><code>
http://www.pets.com/pet-care/
					</code></pre>
					<p>За да работи това, трябва да кажем на сървъра да пренасочи вътрешно всички заявки за <i>URL</i> адреса <i>„pet-care“</i>  към <i>„pet_care_info_07_07_2008.php“</i>. Искаме това да се случи вътрешно, защото не искаме <i>URL</i> адресът в адресната лента на браузъра да се променя.</p>
					<p>За да постигнем това, първо трябва да създадем текстов документ, наречен <i>".htaccess"</i>, който да съдържа нашите правила. Трябва да бъде наименувано точно така (не <i>".htaccess.txt"</i> или <i>"rules.htaccess"</i>). Това ще бъде поставено в главната директория на сървъра (същата папка като <i>"pet_care_info_07_07_2008.php"</i> в нашия пример). Там вече може да има <i>.htaccess</i> файл, в който случай трябва да го редактираме, а не да го презаписваме.</p>
					<p>Файлът <i>.htaccess</i> е конфигурационен файл за сървъра. Ако има грешки във файла, сървърът ще покаже съобщение за грешка (обикновено с код за грешка <i>"500"</i>). Ако прехвърляте файла на сървъра с помощта на <i>FTP</i>, трябва да се уверите, че той е прехвърлен в режим <i>ASCII</i>, а не <i>BINARY</i>. Използваме този файл, за да изпълняваме 2 прости задачи в този случай - първо, да кажем на <i>Apache</i> да включи двигателя за пренаписване и второ, да кажем на apache какво правило за презаписване искаме да използва. Към файла трябва да добавим следното:</p>
					<pre><code>
RewriteEngine On    # Turn on the rewriting engine<br> 
RewriteRule  ^pet-care/?$  pet_care_info_01_02_2008.php  [NC,L]  #  Handle requests for "pet-care"
					</code></pre>
					<p>Няколко бързи неща, които трябва да се споменат - всичко след хеш символа в <i>.htaccess</i> файла се игнорира като коментар и редът <i>"RewriteRule"</i> трябва да присъства точно веднъж за всеки <i>.htaccess</i> файл.</p>
					<p>Редът <i>"RewriteRule"</i> е мястото, където се случва магията. Редът може да бъде разбит на 5 части:</p>
						<ul>
							<li><i>RewriteRule</i> - казва на <i>Apache</i>, че това се отнася само за един <i>RewriteRule</i>.
							</li>
							<li><i>^/pet-care/?$</i> - Шаблонът". Сървърът ще проверява <i>URL</i> адреса на всяка заявка към сайта, за да види дали този модел съвпада. Ако това стане, <i>Apache</i> ще смени <i>URL</i> адреса на заявката за секцията „заместване“ (<i>substitution</i>), която следва.
							</li>
							<li><i>pet_care_info_01_02_2003.php</i> - - "Заместителят". Ако образецът по-горе съответства на заявката, <i>Apache</i> използва този <i>URL</i> вместо искания <i>URL</i> адрес.
							</li>
							<li>[NC,L] - „Флагове“, които казват на <i>Apache</i> как да се приложи правилото. В този случай използваме два флага. <i>„NC“</i>, казва на <i>Apache</i>, че това правило трябва да е нечувствително към регистрите, а <i>„L“</i> казва на <i>Apache</i> да не обработва повече правила, ако това се използва.
							</li>
							<li># Обработващи заявки за <i>"pet-care"</i> - Коментар, обясняващ какво прави правилото (незадължително, но препоръчително)
							</li>
						</ul>
					<p>Правилото по-горе е прост метод за пренаписване на един <i>URL</i> адрес и е основа за почти всички правила за пренаписване на <i>URL</i> адреси.</p>
			</div>
			
			<div>
				<h2 id="modelsandreplace"><u>Модели и замествания</u></h2>
					<p>Горното правило ви позволява да пренасочвате заявки за един <i>URL</i> адрес, но истинската сила на <i>mod_rewrite</i> идва, когато започнете да идентифицирате и пренаписвате групи от <i>URL</i> адреси въз основа на моделите, които съдържат.</p>
					<p>Да приемем, че искате да промените всички <i>URL</i> адреси на вашия сайт, както е описано в първата двойка примери по-горе. Съществуващите Ви <i>URL</i> адреси изглеждат така:</p>
					<pre><code>
http://www.pets.com/show_a_product.php?product_id=7
					</code></pre>
					<p>И искате да ги промените, за да изглеждат така:</p>
					<pre><code>
http://www.pets.com/products/7/
					</code></pre>
					<p>Вместо да напишете правило за всеки индивидуален идентификационен номер на продукта, разбира се, по-скоро бихте написали едно правило за управление на всички идентификатори на продукти. Ефективно искате да промените <i>URL</i> адреси в този формат:</p>
					<pre><code>
http://www.pets.com/show_a_product.php?product_id={a number}
					</code></pre>
					<p>И искате да ги промените, за да изглеждат така:</p>
					<pre><code>
http://www.pets.com/products/{a number}/
					</code></pre>
					<p>За да направите това, ще трябва да използвате <i>"регулярни изрази"</i>. Това са модели, дефинирани в определен формат, които сървърът може да разбере и обработва по подходящ начин. Типичен модел за идентифициране на число ще изглежда така:</p>
					<pre><code>
[0-9]+
					</code></pre>
					<p>Квадратните скоби съдържат диапазон от знаци, а <i>"0-9"</i> показва всички цифри. Символът плюс показва, че моделът ще идентифицира едно или повече от всичко, което предхожда плюса - така че този модел ефективно означава <i>"една или повече цифри"</i> - точно това, което търсим да намерим в нашия <i>URL</i> адрес.</p>
					<p>Цялата част от <i>"шаблона"</i> на правилото се третира по подразбиране като редовен израз - не е необходимо да го включвате или активирате изобщо.</p>
					<pre><code>
RewriteRule    ^products/([0-9]+)/?$    show_a_product.php?product_id=$1    [NC,L]  #  Handle product requests
					</code></pre>
					<p>Първото нещо, което се надявам да забележите, е, че сме увили нашия модел в скоби. Това ни позволява да <i>„препращаме обратно“</i> (реферираме обратно) този раздел на <i>URL</i> адреса в следващата <i>“заместителна”(substitution)</i> секция. <i>"$ 1"</i> в замяната казва на <i>Apache</i> да постави каквото съответства на по-ранния  шаблон в <i>URL</i> адреса в този момент. Можете да имате много връзки и те са номерирани в реда, в който се появяват.</p>
					<p>И така, това <i>RewriteRule</i> ще означава, че <i>Apache</i> пренасочва всички заявки за <i>domain.com/products/{number}/</i> към <i>show_a_product.php? Product_id = {same number}</i>.</p>
			</div>
			
			<div>
				<h2 id="regexp"><u>Регулярни изрази</u></h2>
					<p>Пълното ръководство за регулярните изрази е по-скоро извън обхвата на този реферат. Важни моменти обаче, които трябва да запомните, са, че целият модел се третира като регулярен израз, така че винаги внимавайте за символите, които са "специални" символи в регулярни изрази.</p>
					<p>Най-често това е, когато хората използват период по своя модел. В образец това всъщност означава "всеки символ", а не буквален период, и така че ако искате да съответствате на период (и само период), ще трябва да "избягате" от символа - да го предшествате с друг специален символ, обратна черта, която казва на <i>Apache</i> да приеме следващия символ, който да бъде литерал.</p>
					<p>Например, този <i>RewriteRule</i> не просто ще съответства на <i>URL</i> адреса <i>"rss.xml"</i> по предназначение - той също ще съвпада с <i>"rss1xml"</i>, <i>"rss-xml"</i> и така нататък.</p>
					<pre><code>
RewriteRule    ^rss.xml$    rss.php    [NC,L]    # Change feed URL
					</code></pre>
					<p>Това обикновено не представлява сериозен проблем, но правилното бягство от символите е много добър навик да се впускате рано.</p>
					<p>Това се отнася само за модела, а не за замяната. Следват и други знаци, които изискват избягване (наричано „метасимволи“), като значението им е в скоби след това:</p>
						<ul>
							<li><b>,</b> (всеки знак)
							</li>
							<li><b>*</b> (нула или повече от предходните)
							</li>
							<li><b>+</b> (един или повече от предходните)
							</li>
							<li><b>{}</b> (минимален до максимален количествен показател)
							</li>
							<li><b>?</b> (неправилен модификатор)
							</li>
							<li><b>!</b> (в началото на низ означава "отрицателен модел")
							</li>
							<li><b>^</b> (начало на низ или "отрицателно", ако в началото на диапазон)
							</li>
							<li><b>$</b> (край на низ)
							</li>
							<li><b>[]</b> (съвпада с всеки символ)
							</li>
							<li><b>-</b> (обхват, ако се използва между квадратни скоби)
							</li>
							<li><b>()</b> (група, група с връщане назад)
							</li>
							<li><b>|</b> (алтернативно, или)
							</li>
							<li><b>\</b> (самия символ за бягство)
							</li>
						</ul>
					<p>Използвайки регулярни изрази, е възможно да търсите всякакви модели в <i>URL</i> адреси и да ги пренаписвате, когато съвпадат. Време е за друг пример - искахме по-рано да можем да идентифицираме този <i>URL</i> адрес и да го пренапишем:</p>
					<pre><code>
http://www.pets.com/parrots/norwegian-blue/
					</code></pre>
					<p>И искаме да можем да кажем на сървъра да интерпретира това като следното, но за всички продукти:</p>
					<pre><code>
http://www.pets.com/get_product_by_name.php?product_name=norwegian-blue
					</code></pre>
					<p>И можем да направим това сравнително просто със следното правило:</p>
					<pre><code>
RewriteRule ^parrots/([A-Za-z0-9-]+)/?$ get_product_by_name.php?product_name=$1 [NC,L] 
# Process parrots
					</code></pre>
					<p>С това правило всеки <i>URL</i> адрес, който започва с <i>„parrots“</i>, последван от наклонена черта <i>(parrots /)</i>, след това един или повече <i>(+)</i> от всяка комбинация от букви, цифри и тирета <i>([A-Za-z0-9-])</i> ( обърнете внимание на тирето в края на селекцията от знаци в квадратни скоби - той трябва да бъде добавен там, за да се третира буквално, а не като разделител на обхвата). Ние посочваме името на продукта в скоби с <i>$ 1</i> в замяната.</p>
					<p>Можем да го направим още по-общ, ако искаме, така че няма значение в каква директория изглежда даден продукт, той все още се изпраща към същия скрипт, като така:</p>
					<pre><code>
RewriteRule  ^[A-Za-z-]+/([A-Za-z0-9-]+)/?$ get_product_by_name.php?product_name=$1 [NC,L] 
# Process all products
					</code></pre>
					<p>Както можете да видите, сме заменили <i>"parrots"</i> с модел, който съответства на букви и тирета. Това правило вече ще отговаря на всичко в директорията на папагали или във всяка друга директория, чието име се състои от поне една или повече букви и тирета.</p>
			</div>
			
			<div>
				<h2 id="flags"><u>Знамена</u></h2>
					<p>Флаговете се добавят в края на правило за пренаписване, за да кажат на <i>Apache</i> как да интерпретира и борави с правилото. Те могат да се използват, за да кажат на apache да третира правилото като нечувствително към регистрите, да спре правилата за обработка, ако текущата съвпада, или множество други опции. Те са разделени със запетая и се съдържат в квадратни скоби. Ето списък на знамената с техните значения.</p>
						<ul>
							<li><b>C</b> (окован със следващо правило)
							</li>
							<li><b>CO=cookie</b> (задаване на специфична бисквитка)
							</li>
							<li><b>E=var:value</b> (задайте променлива среда на стойност var към стойността)
							</li>
							<li><b>F</b> (забранено - изпраща 403 заглавие на потребителя)
							</li>
							<li><b>G</b> (изчезва - вече не съществува)
							</li>
							<li><b>Н=handler</b> (задаване на манипулатор)
							</li>
							<li><b>L</b> (последен - спиране на обработката)
							</li>
							<li><b>N</b> (следващо - продължаване на правилата за обработка)
							</li>
							<li><b>NC</b> (нечувствителен към регистъра)
							</li>
							<li><b>NE</b> (не избягвайте специални знаци за URL в изхода)
							</li>
							<li><b>NS</b> (игнорирайте това правило, ако заявката е подзаявка)
							</li>
							<li><b>P</b> (прокси - т.е. apache трябва да вземе отдалеченото съдържание, посочено в секцията за заместване, и да го върне)
							</li>
							<li><b>PT</b> (преминава през - използва се при обработка на URL адреси с допълнителни манипулатори, например mod_alias)
							</li>
							<li><b>R</b> (временно пренасочване към нов URL адрес)
							</li>
							<li><b>R=301</b> (постоянно пренасочване към нов URL адрес)
							</li>
							<li><b>QSA</b> (добавете низ за заявка от заявка към заместен URL)
							</li>
							<li><b>S=x</b> (пропуснете следващите x правила)
							</li>
							<li><b>T=mime-type</b> (тип, определен от mime-type)
							</li>
						</ul>
			</div>

            <div>
                <h2 id="usedresources">Използвани източници</h2>
                    <p id="link1">[1] Computer Hope, URL [<a href="http://www.computerhope.com/jargon/u/url.htm" target="_blank">http://www.computerhope.com/jargon/u/url.htm</a>]</p>
                    <p id="link2">[2] Alone On A Hill, URL Rewriting for Beginners [<a href="https://aloneonahill.com/blog/url-rewriting-for-beginners/" target="_blank">https://aloneonahill.com/blog/url-rewriting-for-beginners/</a>]</p>
			</div>
